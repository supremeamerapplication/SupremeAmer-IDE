<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SupremeAmer IDE Pro - Multi-Platform</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- iOS PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SupremeAmer IDE">
    
    <!-- Theme -->
    <meta name="theme-color" content="#2c3e50" id="theme-color">
    
    <!-- Security -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: http: ws: wss:; script-src 'self' 'unsafe-inline' 'unsafe-eval' https: http:; style-src 'self' 'unsafe-inline' https:; font-src 'self' https:; connect-src 'self' https: http: ws: wss:; frame-src 'self' https:; img-src 'self' data: https:; worker-src 'self' blob:;">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" href="/icons/icon-512.png">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Monaco Editor -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/editor/editor.main.min.css">
    
    <style>
        /* ==================== CSS Variables ==================== */
        :root {
            /* Colors */
            --primary: #2c3e50;
            --primary-dark: #1e2b37;
            --secondary: #4a69bd;
            --secondary-dark: #3a539b;
            --success: #00b894;
            --success-dark: #009d7a;
            --warning: #e17055;
            --warning-dark: #d15b3f;
            --danger: #d63031;
            --danger-dark: #b71c1c;
            --info: #6c5ce7;
            --info-dark: #5649c9;
            
            /* GitHub Colors */
            --github-bg: #0d1117;
            --github-dark: #010409;
            --github-border: #30363d;
            --github-text: #c9d1d9;
            --github-secondary: #8b949e;
            --github-green: #238636;
            --github-green-hover: #2ea043;
            
            /* Dart/Flutter Colors */
            --dart: #0175C2;
            --flutter: #54C5F8;
            
            /* Layout */
            --sidebar-width: 280px;
            --sidebar-collapsed-width: 0;
            --header-height: 64px;
            --footer-height: 32px;
            --border-radius: 8px;
            --transition-speed: 0.3s;
            
            /* Z-indices */
            --z-modal: 2000;
            --z-dropdown: 1500;
            --z-header: 1000;
            --z-sidebar: 900;
        }

        /* Dark Mode */
        .dark-mode {
            --primary: #1a1a2e;
            --primary-dark: #0f0f1a;
            --secondary: #16213e;
            --secondary-dark: #0f1a2f;
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --border-color: #30363d;
        }

        /* Light Mode */
        :root:not(.dark-mode) {
            --bg-primary: #ffffff;
            --bg-secondary: #f6f8fa;
            --text-primary: #24292e;
            --text-secondary: #586069;
            --border-color: #e1e4e8;
        }

        /* ==================== Reset & Base ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            transition: background-color var(--transition-speed) ease;
        }

        /* ==================== App Layout ==================== */
        #app {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .app-header {
            height: var(--header-height);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            position: relative;
            z-index: var(--z-header);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .logo i {
            font-size: 2rem;
            color: var(--secondary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Main Container */
        .main-container {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: width var(--transition-speed) ease;
            overflow: hidden;
            position: relative;
            z-index: var(--z-sidebar);
        }

        .sidebar.collapsed {
            width: 0;
        }

        .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .sidebar-tab.active {
            color: var(--secondary);
            border-bottom-color: var(--secondary);
            background: var(--bg-primary);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .sidebar-content.hidden {
            display: none;
        }

        /* Editor Area */
        .editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-primary);
        }

        .editor-tabs {
            display: flex;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            scrollbar-width: thin;
        }

        .editor-tab {
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            border-right: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            min-width: 120px;
            max-width: 200px;
            position: relative;
        }

        .editor-tab.active {
            background: var(--bg-primary);
            color: var(--text-primary);
            border-bottom: 2px solid var(--secondary);
        }

        .editor-tab.modified .tab-name:after {
            content: 'â€¢';
            margin-left: 4px;
            color: var(--warning);
        }

        .tab-close {
            margin-left: auto;
            padding: 2px 6px;
            border-radius: 4px;
            opacity: 0.5;
            transition: all 0.2s;
        }

        .tab-close:hover {
            opacity: 1;
            background: var(--danger);
            color: white;
        }

        .editor-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .editor-wrapper {
            flex: 1;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .editor-wrapper.active {
            display: flex;
        }

        .monaco-editor-container {
            flex: 1;
            overflow: hidden;
        }

        /* Preview Panel */
        .preview-panel {
            width: 45%;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--border-color);
            background: white;
            transition: width 0.2s;
        }

        .preview-panel.fullscreen {
            position: fixed;
            top: var(--header-height);
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: calc(100vh - var(--header-height));
            z-index: calc(var(--z-modal) - 1);
        }

        .preview-header {
            padding: 10px 15px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-frame {
            flex: 1;
            border: none;
            background: white;
            width: 100%;
        }

        .preview-frame.mobile-view {
            max-width: 375px;
            margin: 0 auto;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        /* Console Panel */
        .console-panel {
            height: 200px;
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            background: var(--bg-secondary);
        }

        .console-header {
            padding: 8px 15px;
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .console-output {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 13px;
            background: #1e1e1e;
            color: #d4d4d4;
        }

        .console-line {
            padding: 2px 0;
            border-bottom: 1px solid #333;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .console-line.error { color: #f48771; }
        .console-line.warn { color: #cca700; }
        .console-line.info { color: #75beff; }
        .console-line.success { color: #89d185; }

        /* ==================== GitHub Integration ==================== */
        .github-section {
            margin-bottom: 20px;
        }

        .github-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: var(--github-bg);
            color: var(--github-text);
            border-radius: 6px;
            border: 1px solid var(--github-border);
        }

        .github-header i {
            font-size: 1.5rem;
            color: #fff;
        }

        .github-login-btn {
            width: 100%;
            padding: 12px;
            background: var(--github-green);
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background 0.2s;
        }

        .github-login-btn:hover {
            background: var(--github-green-hover);
        }

        .github-user {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--github-bg);
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .github-user img {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }

        .github-repo-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin-top: 10px;
        }

        .github-repo-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s;
        }

        .github-repo-item:hover {
            background: var(--bg-secondary);
        }

        .github-repo-item i {
            color: var(--github-secondary);
        }

        .repo-info {
            flex: 1;
        }

        .repo-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .repo-details {
            font-size: 0.8rem;
            color: var(--text-secondary);
            display: flex;
            gap: 15px;
        }

        /* ==================== Dart/Flutter Integration ==================== */
        .dart-section {
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, var(--dart), var(--flutter));
            border-radius: 8px;
            color: white;
        }

        .dart-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .dart-header i {
            font-size: 2rem;
        }

        .dart-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .dart-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .dart-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* ==================== Language Libraries ==================== */
        .libraries-panel {
            position: fixed;
            right: 20px;
            bottom: 220px;
            width: 300px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: var(--z-dropdown);
            display: none;
        }

        .libraries-panel.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .libraries-header {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .libraries-search {
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            width: 100%;
            margin-bottom: 10px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .libraries-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .library-category {
            margin-bottom: 15px;
        }

        .library-category-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--secondary);
        }

        .library-item {
            padding: 8px 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .library-item:hover {
            background: var(--bg-primary);
        }

        .library-item i {
            width: 20px;
            color: var(--secondary);
        }

        .library-name {
            flex: 1;
        }

        .library-version {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* ==================== Terminal ==================== */
        .terminal-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 300px;
            background: #1e1e1e;
            border-top: 1px solid var(--border-color);
            z-index: calc(var(--z-modal) - 2);
            display: none;
        }

        .terminal-panel.show {
            display: flex;
            flex-direction: column;
        }

        .terminal-header {
            padding: 8px 15px;
            background: #2d2d2d;
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .terminal {
            flex: 1;
            padding: 10px;
            font-family: 'Courier New', monospace;
            color: #fff;
            overflow-y: auto;
        }

        .terminal-input-line {
            display: flex;
            align-items: center;
            padding: 5px 10px;
            background: #2d2d2d;
        }

        .terminal-prompt {
            color: #89d185;
            margin-right: 8px;
        }

        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-family: 'Courier New', monospace;
            outline: none;
        }

        /* ==================== Buttons ==================== */
        .btn {
            padding: 8px 14px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--bg-secondary);
            border-color: var(--secondary);
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary-dark);
        }

        .btn-primary:hover {
            background: var(--secondary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
            border-color: var(--success-dark);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            border-color: var(--danger-dark);
        }

        .btn-icon {
            padding: 8px;
            border-radius: 4px;
        }

        /* ==================== Modals ==================== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: var(--z-modal);
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* ==================== Forms ==================== */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
        }

        /* ==================== Notifications ==================== */
        .notification-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: calc(var(--z-modal) + 1);
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .notification {
            padding: 12px 16px;
            border-radius: 6px;
            background: var(--bg-secondary);
            border-left: 4px solid;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }

        .notification.success { border-left-color: var(--success); }
        .notification.error { border-left-color: var(--danger); }
        .notification.warning { border-left-color: var(--warning); }
        .notification.info { border-left-color: var(--info); }

        .notification-close {
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s;
        }

        .notification-close:hover {
            opacity: 1;
        }

        /* ==================== Progress Bar ==================== */
        .progress-bar {
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress {
            height: 100%;
            background: var(--secondary);
            width: 0%;
            transition: width 0.3s;
        }

        /* ==================== Animations ==================== */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ==================== Responsive ==================== */
        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                left: -100%;
                height: 100%;
            }

            .sidebar.show {
                left: 0;
            }

            .preview-panel {
                position: absolute;
                top: 0;
                right: -100%;
                height: 100%;
                width: 100%;
            }

            .preview-panel.show {
                right: 0;
            }

            .header-actions .btn span {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">
                <i class="fas fa-code"></i>
                <span>SupremeAmer IDE Pro</span>
            </div>
            
            <div class="header-actions">
                <button class="btn" id="toggleSidebar">
                    <i class="fas fa-bars"></i>
                    <span>Explorer</span>
                </button>
                
                <button class="btn btn-primary" id="runCode">
                    <i class="fas fa-play"></i>
                    <span>Run</span>
                </button>
                
                <button class="btn" id="saveFile">
                    <i class="fas fa-save"></i>
                    <span>Save</span>
                </button>
                
                <button class="btn" id="newFile">
                    <i class="fas fa-file"></i>
                    <span>New</span>
                </button>
                
                <button class="btn" id="openTerminal">
                    <i class="fas fa-terminal"></i>
                    <span>Terminal</span>
                </button>
                
                <button class="btn" id="toggleTheme">
                    <i class="fas fa-moon"></i>
                    <span>Theme</span>
                </button>
                
                <button class="btn" id="showLibraries">
                    <i class="fas fa-book"></i>
                    <span>Libraries</span>
                </button>
                
                <div id="connectionStatus" class="status-indicator online">
                    <i class="fas fa-circle"></i>
                </div>
            </div>
        </header>

        <!-- Main Container -->
        <div class="main-container">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <h3><i class="fas fa-folder-open"></i> Explorer</h3>
                    <button class="btn-icon" id="closeSidebar">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="sidebar-tabs">
                    <div class="sidebar-tab active" data-tab="files">
                        <i class="fas fa-files"></i> Files
                    </div>
                    <div class="sidebar-tab" data-tab="github">
                        <i class="fab fa-github"></i> GitHub
                    </div>
                    <div class="sidebar-tab" data-tab="dart">
                        <i class="fab fa-dart"></i> Dart
                    </div>
                </div>
                
                <!-- Files Tab -->
                <div class="sidebar-content active" id="files-tab">
                    <div class="file-actions" style="display: flex; gap: 5px; margin-bottom: 15px;">
                        <button class="btn-icon" id="newFileBtn" title="New File">
                            <i class="fas fa-file"></i>
                        </button>
                        <button class="btn-icon" id="newFolderBtn" title="New Folder">
                            <i class="fas fa-folder-plus"></i>
                        </button>
                        <button class="btn-icon" id="refreshFiles" title="Refresh">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="btn-icon" id="uploadFile" title="Upload">
                            <i class="fas fa-upload"></i>
                        </button>
                    </div>
                    
                    <div id="fileExplorer" class="file-explorer">
                        <!-- File tree will be rendered here -->
                        <div class="loading">Loading files...</div>
                    </div>
                </div>
                
                <!-- GitHub Tab -->
                <div class="sidebar-content hidden" id="github-tab">
                    <div class="github-section">
                        <div class="github-header">
                            <i class="fab fa-github"></i>
                            <span>GitHub Integration</span>
                        </div>
                        
                        <div id="githubAuth">
                            <button class="github-login-btn" id="githubLogin">
                                <i class="fab fa-github"></i>
                                Login with GitHub
                            </button>
                        </div>
                        
                        <div id="githubUser" style="display: none;">
                            <div class="github-user">
                                <img id="githubAvatar" src="" alt="">
                                <div>
                                    <div id="githubName"></div>
                                    <small id="githubLogin"></small>
                                </div>
                            </div>
                            
                            <div style="margin: 15px 0;">
                                <button class="btn" id="syncRepos" style="width: 100%;">
                                    <i class="fas fa-sync-alt"></i> Sync Repositories
                                </button>
                            </div>
                            
                            <div id="githubRepos" class="github-repo-list">
                                <!-- Repos will be listed here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Dart/Flutter Tab -->
                <div class="sidebar-content hidden" id="dart-tab">
                    <div class="dart-section">
                        <div class="dart-header">
                            <i class="fab fa-dart"></i>
                            <i class="fab fa-flutter"></i>
                            <span>Dart & Flutter</span>
                        </div>
                        
                        <div class="dart-actions">
                            <button class="dart-btn" id="newDartProject">
                                <i class="fas fa-plus"></i> New Dart Project
                            </button>
                            <button class="dart-btn" id="newFlutterProject">
                                <i class="fas fa-plus"></i> New Flutter Project
                            </button>
                            <button class="dart-btn" id="runDart">
                                <i class="fas fa-play"></i> Run
                            </button>
                            <button class="dart-btn" id="getDartPackages">
                                <i class="fas fa-download"></i> Get Packages
                            </button>
                            <button class="dart-btn" id="buildFlutter">
                                <i class="fas fa-cog"></i> Build
                            </button>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4>Pub Packages</h4>
                            <div id="dartPackages" class="github-repo-list">
                                <!-- Packages will be listed here -->
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Editor Area -->
            <div class="editor-area">
                <!-- Editor Tabs -->
                <div class="editor-tabs" id="editorTabs">
                    <!-- Tabs will be added dynamically -->
                </div>

                <!-- Editor Container -->
                <div class="editor-container">
                    <div class="editor-wrapper active" id="html-editor-wrapper">
                        <div id="html-editor" class="monaco-editor-container"></div>
                    </div>
                    
                    <div class="editor-wrapper" id="css-editor-wrapper">
                        <div id="css-editor" class="monaco-editor-container"></div>
                    </div>
                    
                    <div class="editor-wrapper" id="js-editor-wrapper">
                        <div id="js-editor" class="monaco-editor-container"></div>
                    </div>
                    
                    <div class="editor-wrapper" id="dart-editor-wrapper">
                        <div id="dart-editor" class="monaco-editor-container"></div>
                    </div>
                    
                    <div class="editor-wrapper" id="python-editor-wrapper">
                        <div id="python-editor" class="monaco-editor-container"></div>
                    </div>
                    
                    <div class="editor-wrapper" id="cpp-editor-wrapper">
                        <div id="cpp-editor" class="monaco-editor-container"></div>
                    </div>
                    
                    <div class="editor-wrapper" id="java-editor-wrapper">
                        <div id="java-editor" class="monaco-editor-container"></div>
                    </div>
                </div>

                <!-- Preview Panel -->
                <div class="preview-panel" id="previewPanel">
                    <div class="preview-header">
                        <span><i class="fas fa-eye"></i> Preview</span>
                        <div class="preview-controls">
                            <button class="btn-icon" id="refreshPreview">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button class="btn-icon" id="toggleMobileView">
                                <i class="fas fa-mobile-alt"></i>
                            </button>
                            <button class="btn-icon" id="togglePreviewFullscreen">
                                <i class="fas fa-expand"></i>
                            </button>
                            <button class="btn-icon" id="closePreview" style="display: none;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <iframe id="previewFrame" class="preview-frame" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-modals"></iframe>
                </div>
            </div>
        </div>

        <!-- Console Panel -->
        <div class="console-panel" id="consolePanel">
            <div class="console-header">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <i class="fas fa-terminal"></i>
                    <span>Console</span>
                    <span id="consoleStatus"></span>
                </div>
                <div>
                    <button class="btn-icon" id="clearConsole">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="btn-icon" id="toggleConsole">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
            </div>
            <div id="consoleOutput" class="console-output"></div>
        </div>
    </div>

    <!-- Libraries Panel -->
    <div class="libraries-panel" id="librariesPanel">
        <div class="libraries-header">
            <h4><i class="fas fa-book"></i> Language Libraries</h4>
            <button class="btn-icon" id="closeLibraries">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <input type="text" class="libraries-search" id="librarySearch" placeholder="Search libraries...">
        <div class="libraries-list" id="librariesList">
            <!-- Libraries will be loaded here -->
        </div>
    </div>

    <!-- Terminal Panel -->
    <div class="terminal-panel" id="terminalPanel">
        <div class="terminal-header">
            <span><i class="fas fa-terminal"></i> Terminal</span>
            <button class="btn-icon" id="closeTerminal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="terminal" id="terminal"></div>
        <div class="terminal-input-line">
            <span class="terminal-prompt">$</span>
            <input type="text" class="terminal-input" id="terminalInput" placeholder="Type command...">
        </div>
    </div>

    <!-- New File Modal -->
    <div class="modal-overlay" id="newFileModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Create New File</h3>
                <span class="btn-icon" onclick="hideModal('newFileModal')">
                    <i class="fas fa-times"></i>
                </span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>File Name</label>
                    <input type="text" class="form-control" id="newFileName" placeholder="myfile">
                </div>
                <div class="form-group">
                    <label>Language</label>
                    <select class="form-control" id="newFileLanguage">
                        <option value="html">HTML</option>
                        <option value="css">CSS</option>
                        <option value="javascript">JavaScript</option>
                        <option value="dart">Dart</option>
                        <option value="python">Python</option>
                        <option value="cpp">C++</option>
                        <option value="java">Java</option>
                        <option value="php">PHP</option>
                        <option value="ruby">Ruby</option>
                        <option value="go">Go</option>
                        <option value="rust">Rust</option>
                        <option value="swift">Swift</option>
                        <option value="kotlin">Kotlin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Folder (optional)</label>
                    <input type="text" class="form-control" id="newFileFolder" placeholder="path/to/folder">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="hideModal('newFileModal')">Cancel</button>
                <button class="btn btn-primary" id="createFile">Create</button>
            </div>
        </div>
    </div>

    <!-- GitHub Repo Modal -->
    <div class="modal-overlay" id="githubRepoModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Clone Repository</h3>
                <span class="btn-icon" onclick="hideModal('githubRepoModal')">
                    <i class="fas fa-times"></i>
                </span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Repository URL</label>
                    <input type="text" class="form-control" id="repoUrl" placeholder="https://github.com/user/repo">
                </div>
                <div class="form-group">
                    <label>Branch</label>
                    <input type="text" class="form-control" id="repoBranch" value="main">
                </div>
                <div class="form-group">
                    <label>Local Folder</label>
                    <input type="text" class="form-control" id="repoFolder" placeholder="repo-name">
                </div>
                <div class="progress-bar" style="display: none;" id="cloneProgress">
                    <div class="progress" id="cloneProgressBar"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="hideModal('githubRepoModal')">Cancel</button>
                <button class="btn btn-primary" id="cloneRepo">Clone</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- GitHub OAuth Callback Handler -->
    <script>
        // GitHub OAuth Configuration
        const GITHUB_CONFIG = {
            clientId: 'YOUR_GITHUB_CLIENT_ID', // Replace with your GitHub OAuth app client ID
            redirectUri: window.location.origin + '/github-callback.html',
            scope: 'repo,user,workflow'
        };

        // Language Libraries Database
        const LANGUAGE_LIBRARIES = {
            javascript: {
                name: 'JavaScript',
                icon: 'fab fa-js',
                color: '#f0db4f',
                packages: [
                    { name: 'react', version: '18.2.0', description: 'UI library' },
                    { name: 'vue', version: '3.3.0', description: 'Progressive framework' },
                    { name: 'angular', version: '16.0.0', description: 'Platform for building apps' },
                    { name: 'express', version: '4.18.0', description: 'Web framework for Node.js' },
                    { name: 'lodash', version: '4.17.21', description: 'Utility library' },
                    { name: 'axios', version: '1.4.0', description: 'HTTP client' },
                    { name: 'jquery', version: '3.7.0', description: 'DOM manipulation' },
                    { name: 'three', version: '0.154.0', description: '3D library' },
                    { name: 'd3', version: '7.8.0', description: 'Data visualization' },
                    { name: 'chart.js', version: '4.3.0', description: 'Charts' }
                ]
            },
            python: {
                name: 'Python',
                icon: 'fab fa-python',
                color: '#3776ab',
                packages: [
                    { name: 'django', version: '4.2.0', description: 'Web framework' },
                    { name: 'flask', version: '2.3.0', description: 'Micro web framework' },
                    { name: 'numpy', version: '1.24.0', description: 'Numerical computing' },
                    { name: 'pandas', version: '2.0.0', description: 'Data analysis' },
                    { name: 'matplotlib', version: '3.7.0', description: 'Plotting' },
                    { name: 'tensorflow', version: '2.13.0', description: 'Machine learning' },
                    { name: 'pytorch', version: '2.0.0', description: 'Deep learning' },
                    { name: 'requests', version: '2.31.0', description: 'HTTP library' },
                    { name: 'beautifulsoup4', version: '4.12.0', description: 'Web scraping' },
                    { name: 'scikit-learn', version: '1.3.0', description: 'Machine learning' }
                ]
            },
            dart: {
                name: 'Dart',
                icon: 'fab fa-dart',
                color: '#0175C2',
                packages: [
                    { name: 'flutter', version: '3.13.0', description: 'UI framework' },
                    { name: 'http', version: '1.1.0', description: 'HTTP requests' },
                    { name: 'provider', version: '6.0.0', description: 'State management' },
                    { name: 'riverpod', version: '2.4.0', description: 'State management' },
                    { name: 'dio', version: '5.3.0', description: 'HTTP client' },
                    { name: 'shared_preferences', version: '2.2.0', description: 'Local storage' },
                    { name: 'sqflite', version: '2.3.0', description: 'SQLite database' },
                    { name: 'firebase_core', version: '2.15.0', description: 'Firebase core' },
                    { name: 'bloc', version: '8.1.0', description: 'State management' },
                    { name: 'get_it', version: '7.6.0', description: 'Dependency injection' }
                ]
            },
            cpp: {
                name: 'C++',
                icon: 'fas fa-code',
                color: '#00599c',
                packages: [
                    { name: 'boost', version: '1.82.0', description: 'Collection of libraries' },
                    { name: 'opencv', version: '4.8.0', description: 'Computer vision' },
                    { name: 'eigen', version: '3.4.0', description: 'Linear algebra' },
                    { name: 'qt', version: '6.5.0', description: 'GUI framework' },
                    { name: 'nlohmann/json', version: '3.11.0', description: 'JSON library' },
                    { name: 'spdlog', version: '1.12.0', description: 'Logging' },
                    { name: 'fmt', version: '10.0.0', description: 'Formatting' },
                    { name: 'catch2', version: '3.3.0', description: 'Testing' },
                    { name: 'asio', version: '1.28.0', description: 'Networking' },
                    { name: 'tbb', version: '2021.10.0', description: 'Parallel programming' }
                ]
            },
            java: {
                name: 'Java',
                icon: 'fab fa-java',
                color: '#007396',
                packages: [
                    { name: 'spring-boot', version: '3.1.0', description: 'Application framework' },
                    { name: 'hibernate', version: '6.2.0', description: 'ORM framework' },
                    { name: 'junit', version: '5.9.0', description: 'Testing' },
                    { name: 'mockito', version: '5.4.0', description: 'Mocking' },
                    { name: 'log4j', version: '2.20.0', description: 'Logging' },
                    { name: 'gson', version: '2.10.0', description: 'JSON library' },
                    { name: 'guava', version: '32.0.0', description: 'Google core libraries' },
                    { name: 'apache-commons', version: '3.12.0', description: 'Utilities' },
                    { name: 'lombok', version: '1.18.28', description: 'Boilerplate reduction' },
                    { name: 'jackson', version: '2.15.0', description: 'JSON processing' }
                ]
            }
        };

        // ==================== Application State ====================
        const AppState = {
            user: null,
            githubToken: null,
            currentFile: null,
            openFiles: new Map(),
            modifiedFiles: new Set(),
            repositories: [],
            terminal: null,
            editors: {},
            db: null,
            settings: {
                theme: 'light',
                fontSize: 14,
                autoSave: true,
                wordWrap: true
            }
        };

        // ==================== Database Service ====================
        class DatabaseService {
            constructor() {
                this.db = null;
            }

            async init() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open('SupremeAmerIDE', 2);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve();
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        if (!db.objectStoreNames.contains('files')) {
                            db.createObjectStore('files', { keyPath: 'path' });
                        }
                        
                        if (!db.objectStoreNames.contains('folders')) {
                            db.createObjectStore('folders', { keyPath: 'path' });
                        }
                        
                        if (!db.objectStoreNames.contains('settings')) {
                            db.createObjectStore('settings');
                        }
                        
                        if (!db.objectStoreNames.contains('github')) {
                            db.createObjectStore('github', { keyPath: 'id' });
                        }
                        
                        if (!db.objectStoreNames.contains('repos')) {
                            db.createObjectStore('repos', { keyPath: 'id', autoIncrement: true });
                        }
                    };
                });
            }

            async get(store, key) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(store, 'readonly');
                    const request = transaction.objectStore(store).get(key);
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => resolve(request.result);
                });
            }

            async getAll(store) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(store, 'readonly');
                    const request = transaction.objectStore(store).getAll();
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => resolve(request.result);
                });
            }

            async put(store, value, key = null) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(store, 'readwrite');
                    let request;
                    if (key) {
                        request = transaction.objectStore(store).put(value, key);
                    } else {
                        request = transaction.objectStore(store).put(value);
                    }
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => resolve(request.result);
                });
            }

            async delete(store, key) {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(store, 'readwrite');
                    const request = transaction.objectStore(store).delete(key);
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => resolve();
                });
            }
        }

        // ==================== GitHub Integration ====================
        class GitHubService {
            constructor(db, notifications) {
                this.db = db;
                this.notifications = notifications;
                this.token = null;
                this.user = null;
                this.api = 'https://api.github.com';
            }

            async init() {
                const saved = await this.db.get('github', 'token');
                if (saved) {
                    this.token = saved.token;
                    this.user = saved.user;
                    this.updateUI();
                }
            }

            async login() {
                const authUrl = `https://github.com/login/oauth/authorize?client_id=${GITHUB_CONFIG.clientId}&redirect_uri=${encodeURIComponent(GITHUB_CONFIG.redirectUri)}&scope=${GITHUB_CONFIG.scope}`;
                
                // Open popup for OAuth
                const popup = window.open(authUrl, 'github-oauth', 'width=800,height=600');
                
                // Listen for callback
                window.addEventListener('message', async (event) => {
                    if (event.data.type === 'github-oauth') {
                        const { code } = event.data;
                        await this.exchangeCode(code);
                        popup.close();
                    }
                });
            }

            async exchangeCode(code) {
                try {
                    // In production, this should be done on your backend
                    const response = await fetch('https://your-backend.com/github/token', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ code })
                    });
                    
                    const data = await response.json();
                    this.token = data.access_token;
                    
                    await this.fetchUser();
                    await this.db.put('github', { id: 'token', token: this.token, user: this.user });
                    
                    this.notifications.success('GitHub login successful');
                    this.updateUI();
                    
                } catch (error) {
                    console.error('GitHub login error:', error);
                    this.notifications.error('Failed to login to GitHub');
                }
            }

            async fetchUser() {
                const response = await fetch(`${this.api}/user`, {
                    headers: { 'Authorization': `token ${this.token}` }
                });
                this.user = await response.json();
            }

            async fetchRepos() {
                try {
                    const response = await fetch(`${this.api}/user/repos?per_page=100`, {
                        headers: { 'Authorization': `token ${this.token}` }
                    });
                    
                    const repos = await response.json();
                    AppState.repositories = repos;
                    this.renderRepos(repos);
                    
                } catch (error) {
                    console.error('Error fetching repos:', error);
                    this.notifications.error('Failed to fetch repositories');
                }
            }

            async cloneRepo(repoUrl, branch = 'main', localPath) {
                try {
                    showModal('githubRepoModal');
                    const progressBar = document.getElementById('cloneProgressBar');
                    const progressContainer = document.getElementById('cloneProgress');
                    
                    progressContainer.style.display = 'block';
                    
                    // Parse repo URL
                    const match = repoUrl.match(/github\.com[:\/](.+?)\/(.+?)(?:\.git)?$/);
                    if (!match) throw new Error('Invalid GitHub URL');
                    
                    const [, owner, repo] = match;
                    
                    // Fetch repo contents
                    const response = await fetch(`${this.api}/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`, {
                        headers: { 'Authorization': `token ${this.token}` }
                    });
                    
                    const data = await response.json();
                    const files = data.tree.filter(item => item.type === 'blob');
                    
                    progressBar.style.width = '0%';
                    
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        const filePath = localPath ? `${localPath}/${file.path}` : file.path;
                        
                        // Fetch file content
                        const contentResponse = await fetch(`${this.api}/repos/${owner}/${repo}/contents/${file.path}?ref=${branch}`, {
                            headers: { 'Authorization': `token ${this.token}` }
                        });
                        
                        const contentData = await contentResponse.json();
                        const content = atob(contentData.content);
                        
                        // Save file
                        await fileManager.createFile(
                            file.path.split('/').pop(),
                            this.getLanguageFromPath(file.path),
                            filePath.substring(0, filePath.lastIndexOf('/')),
                            content
                        );
                        
                        progressBar.style.width = `${((i + 1) / files.length) * 100}%`;
                    }
                    
                    hideModal('githubRepoModal');
                    this.notifications.success(`Repository ${repo} cloned successfully`);
                    
                } catch (error) {
                    console.error('Error cloning repo:', error);
                    this.notifications.error('Failed to clone repository');
                    hideModal('githubRepoModal');
                }
            }

            getLanguageFromPath(path) {
                const ext = path.split('.').pop();
                const langMap = {
                    'js': 'javascript',
                    'jsx': 'javascript',
                    'ts': 'typescript',
                    'tsx': 'typescript',
                    'py': 'python',
                    'dart': 'dart',
                    'html': 'html',
                    'css': 'css',
                    'cpp': 'cpp',
                    'c': 'cpp',
                    'h': 'cpp',
                    'java': 'java',
                    'php': 'php',
                    'rb': 'ruby',
                    'go': 'go',
                    'rs': 'rust',
                    'swift': 'swift',
                    'kt': 'kotlin'
                };
                return langMap[ext] || 'plaintext';
            }

            renderRepos(repos) {
                const container = document.getElementById('githubRepos');
                if (!container) return;
                
                container.innerHTML = repos.map(repo => `
                    <div class="github-repo-item" data-repo="${repo.full_name}">
                        <i class="fas fa-book"></i>
                        <div class="repo-info">
                            <div class="repo-name">${repo.name}</div>
                            <div class="repo-details">
                                <span><i class="fas fa-star"></i> ${repo.stargazers_count}</span>
                                <span><i class="fas fa-code-branch"></i> ${repo.forks_count}</span>
                                <span>${repo.language || 'Unknown'}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                // Add click handlers
                container.querySelectorAll('.github-repo-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const repoName = item.dataset.repo;
                        const repo = repos.find(r => r.full_name === repoName);
                        if (repo) {
                            document.getElementById('repoUrl').value = repo.clone_url;
                            document.getElementById('repoFolder').value = repo.name;
                            showModal('githubRepoModal');
                        }
                    });
                });
            }

            updateUI() {
                const authDiv = document.getElementById('githubAuth');
                const userDiv = document.getElementById('githubUser');
                
                if (this.user) {
                    authDiv.style.display = 'none';
                    userDiv.style.display = 'block';
                    
                    document.getElementById('githubAvatar').src = this.user.avatar_url;
                    document.getElementById('githubName').textContent = this.user.name || this.user.login;
                    document.getElementById('githubLogin').textContent = `@${this.user.login}`;
                    
                    this.fetchRepos();
                } else {
                    authDiv.style.display = 'block';
                    userDiv.style.display = 'none';
                }
            }
        }

        // ==================== Dart/Flutter Service ====================
        class DartService {
            constructor(notifications) {
                this.notifications = notifications;
                this.packages = LANGUAGE_LIBRARIES.dart.packages;
            }

            async createDartProject(name, type = 'console') {
                const templates = {
                    console: {
                        'pubspec.yaml': `name: ${name}
description: A simple Dart console application
version: 1.0.0

environment:
  sdk: '>=3.0.0 <4.0.0'

dependencies:
  http: ^1.1.0

dev_dependencies:
  lints: ^2.0.0
  test: ^1.21.0`,
                        
                        'bin/main.dart': `void main(List<String> arguments) {
  print('Hello, ${name}!');
  print('Welcome to your Dart console application.');
}`,
                        
                        'lib/${name}.dart': `library ${name};

/// Main library for ${name}
class ${this.capitalize(name)} {
  String get greeting => 'Hello from ${name}!';
  
  void run() {
    print(greeting);
  }
}`,
                        
                        'README.md': `# ${name}

A Dart console application created with SupremeAmer IDE.
`
                    },
                    
                    web: {
                        'pubspec.yaml': `name: ${name}
description: A Dart web application
version: 1.0.0

environment:
  sdk: '>=3.0.0 <4.0.0'

dependencies:
  http: ^1.1.0

dev_dependencies:
  build_runner: ^2.4.0
  build_web_compilers: ^4.0.0`,
                        
                        'web/index.html': `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${name}</title>
    <script defer src="main.dart.js"></script>
</head>
<body>
    <div id="output"></div>
</body>
</html>`,
                        
                        'web/main.dart': `import 'dart:html';

void main() {
  querySelector('#output').text = 'Hello from ${name}!';
}`,
                        
                        'README.md': `# ${name}

A Dart web application created with SupremeAmer IDE.
`
                    }
                };
                
                const template = templates[type];
                if (!template) return;
                
                // Create project files
                for (const [path, content] of Object.entries(template)) {
                    await fileManager.createFile(
                        path.split('/').pop(),
                        path.endsWith('.dart') ? 'dart' : this.getLanguageFromPath(path),
                        `${name}/${path.substring(0, path.lastIndexOf('/'))}`,
                        content
                    );
                }
                
                this.notifications.success(`Dart ${type} project created: ${name}`);
            }

            async createFlutterProject(name) {
                const template = {
                    'pubspec.yaml': `name: ${name}
description: A new Flutter project
version: 1.0.0+1

environment:
  sdk: '>=3.0.0 <4.0.0'

dependencies:
  flutter:
    sdk: flutter
  cupertino_icons: ^1.0.2
  http: ^1.1.0
  provider: ^6.0.0

dev_dependencies:
  flutter_test:
    sdk: flutter
  flutter_lints: ^2.0.0

flutter:
  uses-material-design: true`,
                    
                    'lib/main.dart': `import 'package:flutter/material.dart';
import 'package:${name}/home_page.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: '${name}',
      theme: ThemeData(
        primarySwatch: Colors.blue,
        useMaterial3: true,
      ),
      home: const HomePage(),
    );
  }
}`,
                    
                    'lib/home_page.dart': `import 'package:flutter/material.dart';

class HomePage extends StatelessWidget {
  const HomePage({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('${name}'),
      ),
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            const Text(
              'Welcome to Flutter!',
              style: TextStyle(fontSize: 24),
            ),
            const SizedBox(height: 20),
            ElevatedButton(
              onPressed: () {
                // Add functionality
              },
              child: const Text('Click Me'),
            ),
          ],
        ),
      ),
    );
  }
}`,
                    
                    'README.md': `# ${name}

A Flutter project created with SupremeAmer IDE.
`
                };
                
                // Create project files
                for (const [path, content] of Object.entries(template)) {
                    await fileManager.createFile(
                        path.split('/').pop(),
                        path.endsWith('.dart') ? 'dart' : this.getLanguageFromPath(path),
                        `${name}/${path.substring(0, path.lastIndexOf('/'))}`,
                        content
                    );
                }
                
                this.notifications.success(`Flutter project created: ${name}`);
            }

            async getPackages() {
                const container = document.getElementById('dartPackages');
                if (!container) return;
                
                container.innerHTML = this.packages.map(pkg => `
                    <div class="github-repo-item" data-package="${pkg.name}">
                        <i class="fab fa-dart"></i>
                        <div class="repo-info">
                            <div class="repo-name">${pkg.name}</div>
                            <div class="repo-details">
                                <span>v${pkg.version}</span>
                                <span>${pkg.description}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                // Add click handlers
                container.querySelectorAll('.github-repo-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const pkgName = item.dataset.package;
                        const pkg = this.packages.find(p => p.name === pkgName);
                        if (pkg) {
                            this.addPackage(pkg);
                        }
                    });
                });
            }

            async addPackage(pkg) {
                // Update pubspec.yaml of current project
                if (!fileManager.currentFile) {
                    this.notifications.warning('Open a Dart project first');
                    return;
                }
                
                // Find pubspec.yaml in project
                const files = await AppState.db.getAll('files');
                const pubspec = files.find(f => f.path.includes('pubspec.yaml'));
                
                if (pubspec) {
                    let content = pubspec.content;
                    
                    // Add dependency if not exists
                    if (!content.includes(`${pkg.name}:`)) {
                        content = content.replace(
                            /dependencies:[\s\S]*?(?=\n\w|$)/,
                            (match) => {
                                return match + `  ${pkg.name}: ^${pkg.version}\n`;
                            }
                        );
                        
                        await fileManager.saveFile({
                            ...pubspec,
                            content
                        });
                        
                        this.notifications.success(`Added ${pkg.name} to project`);
                    } else {
                        this.notifications.info(`${pkg.name} already in project`);
                    }
                }
            }

            capitalize(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            }

            getLanguageFromPath(path) {
                const ext = path.split('.').pop();
                const langMap = {
                    'yaml': 'yaml',
                    'md': 'markdown',
                    'html': 'html',
                    'dart': 'dart'
                };
                return langMap[ext] || 'plaintext';
            }
        }

        // ==================== File Manager ====================
        class FileManager {
            constructor(db, notifications) {
                this.db = db;
                this.notifications = notifications;
                this.currentFile = null;
                this.openFiles = new Map();
            }

            async init() {
                await this.loadFiles();
            }

            async loadFiles() {
                const files = await this.db.getAll('files');
                this.renderFileTree(files);
            }

            async createFile(name, language, folder = '', content = '') {
                const extension = this.getExtension(language);
                const fileName = name.endsWith(extension) ? name : name + extension;
                const path = folder ? `${folder}/${fileName}` : fileName;
                
                // Check if exists
                const existing = await this.db.get('files', path);
                if (existing) {
                    this.notifications.error('File already exists');
                    return null;
                }
                
                // Get template if no content
                if (!content) {
                    content = this.getTemplate(language, fileName);
                }
                
                const file = {
                    path,
                    name: fileName,
                    language,
                    extension,
                    content,
                    created: Date.now(),
                    modified: Date.now(),
                    size: new Blob([content]).size,
                    folder
                };
                
                await this.db.put('files', file);
                await this.loadFiles();
                
                this.notifications.success(`Created ${fileName}`);
                return file;
            }

            async openFile(file) {
                this.currentFile = file;
                
                if (!this.openFiles.has(file.path)) {
                    this.openFiles.set(file.path, file);
                }
                
                this.updateEditorTabs();
                this.switchEditor(file.language);
                
                // Set editor content
                const editor = AppState.editors[file.language];
                if (editor) {
                    editor.setValue(file.content || '');
                }
            }

            async saveFile(file = this.currentFile) {
                if (!file) return;
                
                const editor = AppState.editors[file.language];
                if (editor) {
                    file.content = editor.getValue();
                    file.modified = Date.now();
                    file.size = new Blob([file.content]).size;
                    
                    await this.db.put('files', file);
                    AppState.modifiedFiles.delete(file.path);
                    
                    this.updateEditorTabs();
                    this.notifications.success(`Saved ${file.name}`);
                }
            }

            async deleteFile(path) {
                if (confirm('Delete this file?')) {
                    await this.db.delete('files', path);
                    
                    if (this.currentFile?.path === path) {
                        this.currentFile = null;
                        // Clear editor
                        Object.values(AppState.editors).forEach(e => e.setValue(''));
                    }
                    
                    this.openFiles.delete(path);
                    AppState.modifiedFiles.delete(path);
                    
                    await this.loadFiles();
                    this.updateEditorTabs();
                    
                    this.notifications.success('File deleted');
                }
            }

            renderFileTree(files) {
                const container = document.getElementById('fileExplorer');
                if (!container) return;
                
                // Group files by folder
                const tree = this.buildTree(files);
                
                container.innerHTML = this.renderTree(tree);
                
                // Add click handlers
                container.querySelectorAll('.file-item').forEach(item => {
                    item.addEventListener('click', async () => {
                        const path = item.dataset.path;
                        const file = files.find(f => f.path === path);
                        if (file) {
                            await this.openFile(file);
                        }
                    });
                });
            }

            buildTree(files) {
                const tree = {};
                
                files.forEach(file => {
                    const parts = file.path.split('/');
                    let current = tree;
                    
                    for (let i = 0; i < parts.length - 1; i++) {
                        const part = parts[i];
                        if (!current[part]) {
                            current[part] = { _type: 'folder', _children: {} };
                        }
                        current = current[part]._children;
                    }
                    
                    const fileName = parts[parts.length - 1];
                    current[fileName] = { ...file, _type: 'file' };
                });
                
                return tree;
            }

            renderTree(tree, level = 0) {
                let html = '<ul class="file-tree">';
                
                Object.entries(tree).forEach(([name, item]) => {
                    if (item._type === 'folder') {
                        html += `
                            <li class="folder-item">
                                <div class="folder-header">
                                    <i class="fas fa-chevron-right"></i>
                                    <i class="fas fa-folder"></i>
                                    <span>${name}</span>
                                </div>
                                <div class="folder-contents" style="display: none;">
                                    ${this.renderTree(item._children, level + 1)}
                                </div>
                            </li>
                        `;
                    } else if (item._type === 'file') {
                        const icon = this.getFileIcon(item.language);
                        html += `
                            <li class="file-item" data-path="${item.path}">
                                <i class="${icon.icon}" style="color: ${icon.color};"></i>
                                <span class="file-name">${item.name}</span>
                                <span class="file-size">${this.formatSize(item.size)}</span>
                            </li>
                        `;
                    }
                });
                
                html += '</ul>';
                return html;
            }

            getFileIcon(language) {
                const icons = {
                    'html': { icon: 'fab fa-html5', color: '#e34c26' },
                    'css': { icon: 'fab fa-css3-alt', color: '#264de4' },
                    'javascript': { icon: 'fab fa-js', color: '#f0db4f' },
                    'dart': { icon: 'fab fa-dart', color: '#0175C2' },
                    'python': { icon: 'fab fa-python', color: '#3776ab' },
                    'cpp': { icon: 'fas fa-code', color: '#00599c' },
                    'java': { icon: 'fab fa-java', color: '#007396' }
                };
                return icons[language] || { icon: 'fas fa-file', color: '#666' };
            }

            getExtension(language) {
                const exts = {
                    'html': '.html',
                    'css': '.css',
                    'javascript': '.js',
                    'dart': '.dart',
                    'python': '.py',
                    'cpp': '.cpp',
                    'java': '.java',
                    'php': '.php',
                    'ruby': '.rb',
                    'go': '.go',
                    'rust': '.rs',
                    'swift': '.swift',
                    'kotlin': '.kt'
                };
                return exts[language] || '.txt';
            }

            getTemplate(language, fileName) {
                const templates = {
                    'html': `<!DOCTYPE html>
<html>
<head>
    <title>${fileName}</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Hello from ${fileName}</h1>
    <script src="script.js"></script>
</body>
</html>`,
                    
                    'css': `/* ${fileName} */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    line-height: 1.6;
    color: #333;
}`,
                    
                    'javascript': `// ${fileName}
console.log('${fileName} loaded');

document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM ready');
});`,
                    
                    'dart': `// ${fileName}
void main() {
  print('Hello from ${fileName}');
}`,
                    
                    'python': `# ${fileName}
def main():
    print("Hello from ${fileName}")

if __name__ == "__main__":
    main()`
                };
                
                return templates[language] || `// ${fileName}\n`;
            }

            updateEditorTabs() {
                const container = document.getElementById('editorTabs');
                if (!container) return;
                
                container.innerHTML = '';
                
                this.openFiles.forEach((file, path) => {
                    const tab = document.createElement('div');
                    tab.className = `editor-tab ${this.currentFile?.path === path ? 'active' : ''} ${AppState.modifiedFiles.has(path) ? 'modified' : ''}`;
                    tab.dataset.path = path;
                    
                    const icon = this.getFileIcon(file.language);
                    
                    tab.innerHTML = `
                        <i class="${icon.icon}" style="color: ${icon.color};"></i>
                        <span class="tab-name">${file.name}</span>
                        <span class="tab-close" onclick="fileManager.closeFile('${path}')">&times;</span>
                    `;
                    
                    tab.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('tab-close')) {
                            this.openFile(file);
                        }
                    });
                    
                    container.appendChild(tab);
                });
            }

            async closeFile(path) {
                if (AppState.modifiedFiles.has(path)) {
                    if (!confirm('File has unsaved changes. Close anyway?')) {
                        return;
                    }
                }
                
                this.openFiles.delete(path);
                AppState.modifiedFiles.delete(path);
                
                if (this.currentFile?.path === path) {
                    const nextFile = this.openFiles.values().next().value;
                    if (nextFile) {
                        await this.openFile(nextFile);
                    } else {
                        this.currentFile = null;
                        Object.values(AppState.editors).forEach(e => e.setValue(''));
                    }
                }
                
                this.updateEditorTabs();
            }

            switchEditor(language) {
                document.querySelectorAll('.editor-wrapper').forEach(w => {
                    w.classList.remove('active');
                });
                
                const wrapper = document.getElementById(`${language}-editor-wrapper`);
                if (wrapper) {
                    wrapper.classList.add('active');
                }
            }

            formatSize(bytes) {
                if (!bytes) return '0 B';
                const k = 1024;
                const sizes = ['B', 'KB', 'MB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
            }
        }

        // ==================== Console Manager ====================
        class ConsoleManager {
            constructor() {
                this.output = document.getElementById('consoleOutput');
                this.history = [];
            }

            log(message, type = 'info') {
                const line = document.createElement('div');
                line.className = `console-line ${type}`;
                
                const timestamp = new Date().toLocaleTimeString();
                line.innerHTML = `<span class="console-timestamp">[${timestamp}]</span> ${this.escapeHtml(message)}`;
                
                this.output.appendChild(line);
                this.output.scrollTop = this.output.scrollHeight;
                
                this.history.push({ message, type, timestamp });
            }

            clear() {
                this.output.innerHTML = '';
                this.history = [];
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // ==================== Libraries Panel ====================
        class LibrariesManager {
            constructor() {
                this.panel = document.getElementById('librariesPanel');
                this.searchInput = document.getElementById('librarySearch');
                this.list = document.getElementById('librariesList');
                this.init();
            }

            init() {
                this.searchInput.addEventListener('input', () => this.search());
                this.render();
            }

            render() {
                let html = '';
                
                Object.entries(LANGUAGE_LIBRARIES).forEach(([lang, data]) => {
                    html += `
                        <div class="library-category">
                            <div class="library-category-title">
                                <i class="${data.icon}" style="color: ${data.color};"></i>
                                ${data.name}
                            </div>
                    `;
                    
                    data.packages.forEach(pkg => {
                        html += `
                            <div class="library-item" data-lang="${lang}" data-package="${pkg.name}">
                                <i class="${data.icon}"></i>
                                <span class="library-name">${pkg.name}</span>
                                <span class="library-version">${pkg.version}</span>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                });
                
                this.list.innerHTML = html;
                
                // Add click handlers
                this.list.querySelectorAll('.library-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const lang = item.dataset.lang;
                        const pkgName = item.dataset.package;
                        const pkg = LANGUAGE_LIBRARIES[lang].packages.find(p => p.name === pkgName);
                        this.addToProject(pkg, lang);
                    });
                });
            }

            search() {
                const term = this.searchInput.value.toLowerCase();
                const items = this.list.querySelectorAll('.library-item');
                
                items.forEach(item => {
                    const name = item.querySelector('.library-name').textContent.toLowerCase();
                    if (name.includes(term)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            }

            async addToProject(pkg, lang) {
                if (!fileManager.currentFile) {
                    notifications.warning('Open a file first to add packages');
                    return;
                }
                
                // Generate import statement based on language
                let importStatement = '';
                switch (lang) {
                    case 'javascript':
                        importStatement = `// npm install ${pkg.name}@${pkg.version}\nimport ${pkg.name.replace('-', '_')} from '${pkg.name}';\n`;
                        break;
                    case 'python':
                        importStatement = `# pip install ${pkg.name}==${pkg.version}\nimport ${pkg.name.replace('-', '_')}\n`;
                        break;
                    case 'dart':
                        importStatement = `# In pubspec.yaml:\n#   ${pkg.name}: ^${pkg.version}\n\nimport 'package:${pkg.name}/${pkg.name}.dart';\n`;
                        break;
                }
                
                const editor = AppState.editors[fileManager.currentFile.language];
                if (editor) {
                    const current = editor.getValue();
                    editor.setValue(importStatement + '\n' + current);
                    notifications.success(`Added ${pkg.name} to your code`);
                }
            }

            show() {
                this.panel.classList.add('show');
            }

            hide() {
                this.panel.classList.remove('show');
            }
        }

        // ==================== Terminal Emulator ====================
        class Terminal {
            constructor() {
                this.element = document.getElementById('terminal');
                this.input = document.getElementById('terminalInput');
                this.history = [];
                this.historyIndex = -1;
                this.commands = {
                    'help': () => this.showHelp(),
                    'clear': () => this.clear(),
                    'ls': () => this.listFiles(),
                    'pwd': () => this.printWorkingDir(),
                    'date': () => new Date().toString(),
                    'echo': (args) => args.join(' '),
                    'mkdir': (args) => this.createFolder(args[0]),
                    'touch': (args) => this.createFile(args[0])
                };
                
                this.init();
            }

            init() {
                this.input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        this.execute(this.input.value);
                        this.input.value = '';
                    } else if (e.key === 'ArrowUp') {
                        this.historyUp();
                    } else if (e.key === 'ArrowDown') {
                        this.historyDown();
                    }
                });
                
                this.print('Welcome to SupremeAmer IDE Terminal');
                this.print('Type "help" for available commands');
                this.print('');
            }

            execute(input) {
                if (!input.trim()) return;
                
                this.history.push(input);
                this.historyIndex = this.history.length;
                
                this.print(`$ ${input}`, 'input');
                
                const [cmd, ...args] = input.split(' ');
                
                if (this.commands[cmd]) {
                    try {
                        const result = this.commands[cmd](args);
                        if (result) this.print(result);
                    } catch (error) {
                        this.print(`Error: ${error.message}`, 'error');
                    }
                } else {
                    this.print(`Command not found: ${cmd}`, 'error');
                }
            }

            print(text, type = 'output') {
                const line = document.createElement('div');
                line.className = `console-line ${type}`;
                line.textContent = text;
                this.element.appendChild(line);
                this.element.scrollTop = this.element.scrollHeight;
            }

            clear() {
                this.element.innerHTML = '';
            }

            showHelp() {
                return 'Available commands: help, clear, ls, pwd, date, echo, mkdir, touch';
            }

            async listFiles() {
                const files = await AppState.db.getAll('files');
                return files.map(f => f.name).join('\n');
            }

            printWorkingDir() {
                return '/workspace';
            }

            historyUp() {
                if (this.historyIndex > 0) {
                    this.historyIndex--;
                    this.input.value = this.history[this.historyIndex];
                }
            }

            historyDown() {
                if (this.historyIndex < this.history.length - 1) {
                    this.historyIndex++;
                    this.input.value = this.history[this.historyIndex];
                } else {
                    this.historyIndex = this.history.length;
                    this.input.value = '';
                }
            }

            async createFolder(name) {
                // Implement folder creation
                this.print(`Created folder: ${name}`);
            }

            async createFile(name) {
                // Implement file creation
                this.print(`Created file: ${name}`);
            }
        }

        // ==================== Notification System ====================
        class NotificationManager {
            constructor() {
                this.container = document.getElementById('notificationContainer');
            }

            show(message, type = 'info', duration = 5000) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                const icons = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-circle',
                    warning: 'fa-exclamation-triangle',
                    info: 'fa-info-circle'
                };
                
                notification.innerHTML = `
                    <i class="fas ${icons[type]}"></i>
                    <span>${message}</span>
                    <span class="notification-close">&times;</span>
                `;
                
                notification.querySelector('.notification-close').addEventListener('click', () => {
                    notification.remove();
                });
                
                this.container.appendChild(notification);
                
                if (duration > 0) {
                    setTimeout(() => notification.remove(), duration);
                }
            }

            success(message) { this.show(message, 'success'); }
            error(message) { this.show(message, 'error', 8000); }
            warning(message) { this.show(message, 'warning', 6000); }
            info(message) { this.show(message, 'info'); }
        }

        // ==================== Initialize Application ====================
        const notifications = new NotificationManager();
        const consoleManager = new ConsoleManager();
        const librariesManager = new LibrariesManager();
        let fileManager, github, dart, terminal;

        async function init() {
            try {
                notifications.info('Initializing SupremeAmer IDE...');
                
                // Initialize database
                AppState.db = new DatabaseService();
                await AppState.db.init();
                
                // Initialize services
                fileManager = new FileManager(AppState.db, notifications);
                await fileManager.init();
                
                github = new GitHubService(AppState.db, notifications);
                await github.init();
                
                dart = new DartService(notifications);
                dart.getPackages();
                
                terminal = new Terminal();
                
                // Initialize Monaco Editor
                await initMonaco();
                
                // Load settings
                await loadSettings();
                
                // Setup event listeners
                setupEventListeners();
                
                notifications.success('IDE ready!');
                
            } catch (error) {
                console.error('Init error:', error);
                notifications.error('Failed to initialize: ' + error.message);
            }
        }

        function initMonaco() {
            return new Promise((resolve) => {
                require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs' } });
                
                require(['vs/editor/editor.main'], () => {
                    // HTML Editor
                    AppState.editors.html = monaco.editor.create(document.getElementById('html-editor'), {
                        value: '',
                        language: 'html',
                        theme: 'vs-dark',
                        automaticLayout: true,
                        minimap: { enabled: false }
                    });
                    
                    // CSS Editor
                    AppState.editors.css = monaco.editor.create(document.getElementById('css-editor'), {
                        value: '',
                        language: 'css',
                        theme: 'vs-dark',
                        automaticLayout: true,
                        minimap: { enabled: false }
                    });
                    
                    // JavaScript Editor
                    AppState.editors.javascript = monaco.editor.create(document.getElementById('js-editor'), {
                        value: '',
                        language: 'javascript',
                        theme: 'vs-dark',
                        automaticLayout: true,
                        minimap: { enabled: false }
                    });
                    
                    // Dart Editor
                    AppState.editors.dart = monaco.editor.create(document.getElementById('dart-editor'), {
                        value: '',
                        language: 'dart',
                        theme: 'vs-dark',
                        automaticLayout: true,
                        minimap: { enabled: false }
                    });
                    
                    // Python Editor
                    AppState.editors.python = monaco.editor.create(document.getElementById('python-editor'), {
                        value: '',
                        language: 'python',
                        theme: 'vs-dark',
                        automaticLayout: true,
                        minimap: { enabled: false }
                    });
                    
                    // C++ Editor
                    AppState.editors.cpp = monaco.editor.create(document.getElementById('cpp-editor'), {
                        value: '',
                        language: 'cpp',
                        theme: 'vs-dark',
                        automaticLayout: true,
                        minimap: { enabled: false }
                    });
                    
                    // Java Editor
                    AppState.editors.java = monaco.editor.create(document.getElementById('java-editor'), {
                        value: '',
                        language: 'java',
                        theme: 'vs-dark',
                        automaticLayout: true,
                        minimap: { enabled: false }
                    });
                    
                    // Add change listeners
                    Object.entries(AppState.editors).forEach(([lang, editor]) => {
                        editor.onDidChangeModelContent(() => {
                            if (fileManager.currentFile && fileManager.currentFile.language === lang) {
                                AppState.modifiedFiles.add(fileManager.currentFile.path);
                                fileManager.updateEditorTabs();
                            }
                        });
                    });
                    
                    resolve();
                });
            });
        }

        function setupEventListeners() {
            // Sidebar tabs
            document.querySelectorAll('.sidebar-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    
                    document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    document.querySelectorAll('.sidebar-content').forEach(c => c.classList.add('hidden'));
                    document.getElementById(`${tabName}-tab`).classList.remove('hidden');
                });
            });
            
            // GitHub login
            document.getElementById('githubLogin').addEventListener('click', () => github.login());
            
            // Sync repos
            document.getElementById('syncRepos').addEventListener('click', () => github.fetchRepos());
            
            // Clone repo
            document.getElementById('cloneRepo').addEventListener('click', () => {
                const url = document.getElementById('repoUrl').value;
                const branch = document.getElementById('repoBranch').value;
                const folder = document.getElementById('repoFolder').value;
                github.cloneRepo(url, branch, folder);
            });
            
            // New file
            document.getElementById('newFile').addEventListener('click', () => showModal('newFileModal'));
            document.getElementById('newFileBtn').addEventListener('click', () => showModal('newFileModal'));
            
            // Create file
            document.getElementById('createFile').addEventListener('click', async () => {
                const name = document.getElementById('newFileName').value;
                const lang = document.getElementById('newFileLanguage').value;
                const folder = document.getElementById('newFileFolder').value;
                
                if (name) {
                    const file = await fileManager.createFile(name, lang, folder);
                    if (file) {
                        hideModal('newFileModal');
                        await fileManager.openFile(file);
                    }
                }
            });
            
            // Save file
            document.getElementById('saveFile').addEventListener('click', () => fileManager.saveFile());
            
            // Run code
            document.getElementById('runCode').addEventListener('click', runCode);
            
            // Theme toggle
            document.getElementById('toggleTheme').addEventListener('click', toggleTheme);
            
            // Terminal
            document.getElementById('openTerminal').addEventListener('click', () => {
                document.getElementById('terminalPanel').classList.toggle('show');
            });
            
            document.getElementById('closeTerminal').addEventListener('click', () => {
                document.getElementById('terminalPanel').classList.remove('show');
            });
            
            // Libraries
            document.getElementById('showLibraries').addEventListener('click', () => {
                librariesManager.show();
            });
            
            document.getElementById('closeLibraries').addEventListener('click', () => {
                librariesManager.hide();
            });
            
            // Sidebar toggle
            document.getElementById('toggleSidebar').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('collapsed');
            });
            
            document.getElementById('closeSidebar').addEventListener('click', () => {
                document.getElementById('sidebar').classList.add('collapsed');
            });
            
            // Preview controls
            document.getElementById('refreshPreview').addEventListener('click', refreshPreview);
            document.getElementById('toggleMobileView').addEventListener('click', toggleMobileView);
            document.getElementById('togglePreviewFullscreen').addEventListener('click', togglePreviewFullscreen);
            
            // Console
            document.getElementById('clearConsole').addEventListener('click', () => consoleManager.clear());
            document.getElementById('toggleConsole').addEventListener('click', toggleConsole);
            
            // Dart/Flutter
            document.getElementById('newDartProject').addEventListener('click', () => {
                const name = prompt('Enter project name:');
                if (name) dart.createDartProject(name, 'console');
            });
            
            document.getElementById('newFlutterProject').addEventListener('click', () => {
                const name = prompt('Enter project name:');
                if (name) dart.createFlutterProject(name);
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    fileManager.saveFile();
                }
                
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    runCode();
                }
                
                if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                    e.preventDefault();
                    showModal('newFileModal');
                }
                
                if ((e.ctrlKey || e.metaKey) && e.key === '`') {
                    e.preventDefault();
                    document.getElementById('terminalPanel').classList.toggle('show');
                }
            });
        }

        async function runCode() {
            try {
                const html = AppState.editors.html.getValue();
                const css = AppState.editors.css.getValue();
                const js = AppState.editors.javascript.getValue();
                
                consoleManager.clear();
                consoleManager.log('Running code...', 'info');
                
                const preview = document.getElementById('previewFrame');
                const doc = preview.contentDocument || preview.contentWindow.document;
                
                doc.open();
                doc.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <style>${css}</style>
                    </head>
                    <body>
                        ${html}
                        <script>
                            (function() {
                                const originalLog = console.log;
                                const originalError = console.error;
                                const originalWarn = console.warn;
                                const originalInfo = console.info;
                                
                                console.log = function(...args) {
                                    originalLog.apply(console, args);
                                    window.parent.postMessage({
                                        type: 'console',
                                        method: 'log',
                                        args: args.map(a => String(a)).join(' ')
                                    }, '*');
                                };
                                
                                console.error = function(...args) {
                                    originalError.apply(console, args);
                                    window.parent.postMessage({
                                        type: 'console',
                                        method: 'error',
                                        args: args.map(a => String(a)).join(' ')
                                    }, '*');
                                };
                                
                                console.warn = function(...args) {
                                    originalWarn.apply(console, args);
                                    window.parent.postMessage({
                                        type: 'console',
                                        method: 'warn',
                                        args: args.map(a => String(a)).join(' ')
                                    }, '*');
                                };
                                
                                console.info = function(...args) {
                                    originalInfo.apply(console, args);
                                    window.parent.postMessage({
                                        type: 'console',
                                        method: 'info',
                                        args: args.map(a => String(a)).join(' ')
                                    }, '*');
                                };
                            })();
                        </script>
                        <script>${js}</script>
                    </body>
                    </html>
                `);
                doc.close();
                
                consoleManager.log('Code executed successfully', 'success');
                
            } catch (error) {
                console.error('Run error:', error);
                consoleManager.log(`Error: ${error.message}`, 'error');
            }
        }

        function refreshPreview() {
            const frame = document.getElementById('previewFrame');
            frame.src = frame.src;
        }

        function toggleMobileView() {
            const frame = document.getElementById('previewFrame');
            frame.classList.toggle('mobile-view');
        }

        function togglePreviewFullscreen() {
            const panel = document.getElementById('previewPanel');
            panel.classList.toggle('fullscreen');
            
            const btn = document.getElementById('togglePreviewFullscreen');
            btn.innerHTML = panel.classList.contains('fullscreen') ? 
                '<i class="fas fa-compress"></i>' : 
                '<i class="fas fa-expand"></i>';
        }

        function toggleConsole() {
            const panel = document.getElementById('consolePanel');
            const btn = document.getElementById('toggleConsole');
            
            if (panel.style.height === '200px') {
                panel.style.height = '0';
                panel.style.overflow = 'hidden';
                btn.innerHTML = '<i class="fas fa-chevron-up"></i>';
            } else {
                panel.style.height = '200px';
                panel.style.overflow = 'visible';
                btn.innerHTML = '<i class="fas fa-chevron-down"></i>';
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const btn = document.getElementById('toggleTheme');
            const icon = btn.querySelector('i');
            
            if (document.body.classList.contains('dark-mode')) {
                icon.className = 'fas fa-sun';
                monaco.editor.setTheme('vs-dark');
            } else {
                icon.className = 'fas fa-moon';
                monaco.editor.setTheme('vs');
            }
        }

        async function loadSettings() {
            const settings = await AppState.db.get('settings', 'preferences');
            if (settings) {
                AppState.settings = { ...AppState.settings, ...settings };
                
                if (AppState.settings.theme === 'dark') {
                    document.body.classList.add('dark-mode');
                    monaco.editor.setTheme('vs-dark');
                }
            }
        }

        function showModal(id) {
            document.getElementById(id).classList.add('show');
        }

        function hideModal(id) {
            document.getElementById(id).classList.remove('show');
        }

        // Listen for console messages from iframe
        window.addEventListener('message', (event) => {
            if (event.data.type === 'console') {
                const { method, args } = event.data;
                consoleManager.log(args, method);
            }
        });

        // Handle online/offline
        window.addEventListener('online', () => {
            document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-circle"></i>';
            document.getElementById('connectionStatus').className = 'status-indicator online';
            notifications.success('Back online');
        });

        window.addEventListener('offline', () => {
            document.getElementById('connectionStatus').innerHTML = '<i class="fas fa-circle"></i>';
            document.getElementById('connectionStatus').className = 'status-indicator offline';
            notifications.warning('You are offline');
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
